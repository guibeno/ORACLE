


CREATE OR REPLACE PROCEDURE listas_musica_mais_salva
    contador_menor = 0
    loop 
        select count(m.musicasalva_id) into contador
        from musica_musicasalva_playlists m
        where m.musicasalva_id = m.musicasalva_id
        
        if contador > contador_menor
            contador_menor = contador
            select nome into nome_musica
            from musica_musicasalva
            where id = m.musicasalva_id
    end loop
            
        dbms.outputline(musica mais adicionada em playslit 1 nome_musica
        dbms.outputline(musica mais adicionada em playslit 2 nome_musica
        fazer isso ate 15
        
        


INSERT INTO musica_playlist (ID, NOME, DESCRICAO, USER_ID) VALUES (75, 'Músicas curtidas', 'Suas músicas curtidas', 22);
INSERT INTO musica_playlist (ID, NOME, DESCRICAO, USER_ID) VALUES (93, 'Playlist Rap', 'Playlist Rap', 1);
INSERT INTO musica_playlist (ID, NOME, DESCRICAO, USER_ID) VALUES (77, 'edu', 'edu1', 24);
INSERT INTO musica_playlist (ID, NOME, DESCRICAO, USER_ID) VALUES (76, 'Teste', 'insano', 22);

-- Playlist 75
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (1, 511, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (2, 563, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (3, 564, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (4, 565, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (5, 566, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (6, 567, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (7, 568, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (8, 569, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (9, 522, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (10, 515, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (11, 516, 75);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (12, 517, 75);

-- Playlist 93
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (13, 518, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (14, 519, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (15, 520, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (16, 521, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (17, 523, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (18, 532, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (19, 533, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (20, 534, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (21, 535, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (22, 536, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (23, 537, 93);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (24, 511, 93);

-- Playlist 77
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (25, 563, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (26, 564, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (27, 565, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (28, 566, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (29, 567, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (30, 568, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (31, 569, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (32, 522, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (33, 515, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (34, 516, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (35, 517, 77);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (36, 518, 77);

-- Playlist 76
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (37, 519, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (38, 520, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (39, 521, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (40, 523, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (41, 532, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (42, 533, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (43, 534, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (44, 535, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (45, 536, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (46, 537, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (47, 511, 76);
INSERT INTO musica_musicasalva_playlists (ID, MUSICASALVA_ID, PLAYLIST_ID) VALUES (48, 563, 76);

select * from musica_musicasalva;
select * from musica_playlist;
select * from musica_musicasalva_playlists;

CREATE OR REPLACE PROCEDURE listas_musica_mais_salva1 IS
  -- cursor para pegar as 15 músicas mais salvas
  CURSOR c_top_musicas IS
    SELECT m.musicasalva_id, COUNT(*) AS total
    FROM musica_musicasalva_playlists m
    GROUP BY m.musicasalva_id
    ORDER BY total DESC
    FETCH FIRST 15 ROWS ONLY;

  nome_musica VARCHAR2(255);
  contador INTEGER := 0;
BEGIN
  FOR rec IN c_top_musicas LOOP
    -- pegar o nome da musica na tabela musica_musicasalva
    SELECT nome INTO nome_musica FROM musica_musicasalva WHERE id = rec.musicasalva_id;

    contador := contador + 1;
    DBMS_OUTPUT.PUT_LINE('Musica mais adicionada em playlist ' || contador || ': ' || nome_musica || ' (salva ' || rec.total || ' vezes)');
  END LOOP;
END;

BEGIN
  listas_musica_mais_salva1;
END;


